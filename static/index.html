<!DOCTYPE html>
<html lang="ja">
<!-- ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ -->
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StockEasyï½œã‚‰ãã‚‰ãå‚™å“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+Tokumin&family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Noto Sans JP", "Segoe UI", sans-serif;
      margin: 0;
      background: linear-gradient(to bottom right, #f3e8ff, #ede9fe);
    }

    .sub-heading {
      font-family: 'M PLUS Rounded 1c', sans-serif;
      font-size: 1rem;
      color: #6d6f788f;
      font-weight: 500;
      margin-bottom: 1.5rem;
    }
    
    /* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .hero-section {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 30% 50%, rgba(255,255,255,0.1) 0%, transparent 50%);
    }
    .hero-content {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 4rem;
      align-items: center;
      position: relative;
      z-index: 1;
    }
    .hero-text {
      color: white;
    }
    .hero-title {
      font-size: 3.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, #fff, #e0e7ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero-subtitle {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      opacity: 0.9;
      font-weight: 300;
    }
    .hero-description {
      font-size: 1.1rem;
      opacity: 0.8;
      line-height: 1.8;
    }
    
    /* ãƒ­ã‚°ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ */
    .login-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .login-card h3 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      color: #333;
      text-align: center;
      font-weight: 600;
    }
    .role-select {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 1rem;
      background: white;
      transition: all 0.3s ease;
    }
    .role-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .password-area {
      margin-bottom: 1.5rem;
      display: none;
    }
    .password-area input {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e1e5e9;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .password-area input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .login-btn {
      width: 100%;
      padding: 1rem 2rem;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    
    /* æ©Ÿèƒ½ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .features-section {
      padding: 6rem 0;
      background: white;
    }
    .section-title {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 3rem;
      color: #333;
      font-weight: 700;
    }
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
    }
    .feature-card {
      text-align: center;
      padding: 2.5rem 1.5rem;
      background: #f8fafc;
      border-radius: 16px;
      transition: all 0.3s ease;
      border: 1px solid #e2e8f0;
    }
    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      background: white;
    }
    .feature-icon {
      font-size: 3rem;
      margin-bottom: 1.5rem;
    }
    .feature-card h3 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: #333;
      font-weight: 600;
    }
    .feature-card p {
      color: #666;
      line-height: 1.6;
    }
    
    /* åˆ©ç”¨è€…ã®å£°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .testimonials-section {
      padding: 6rem 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .testimonials-section .section-title {
      color: white;
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 3rem;
      font-weight: 700;
    }
    
    .testimonials-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .testimonial-card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 2rem;
      color: #333;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .testimonial-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
    }
    
    .testimonial-content {
      margin-bottom: 1.5rem;
    }
    
    .quote-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .testimonial-text {
      font-size: 1rem;
      line-height: 1.7;
      color: #555;
      font-style: italic;
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .testimonial-author {
      border-top: 1px solid #e1e5e9;
      padding-top: 1rem;
    }
    
    .author-info h4 {
      color: #667eea;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    
    .author-info span {
      display: block;
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 0.2rem;
    }
    
    .author-info .role {
      color: #8b5cf6;
      font-weight: 500;
      font-size: 0.85rem;
    }
    
    /* åˆ©ç”¨è€…åˆ¥æ©Ÿèƒ½ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .roles-section {
      padding: 6rem 0;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }
    .roles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 3rem;
    }
    .role-card {
      background: white;
      padding: 3rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    .role-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }
    .role-card h3 {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      font-weight: 600;
    }
    .staff-card h3 {
      color: #10b981;
    }
    .admin-card h3 {
      color: #8b5cf6;
    }
    .role-card ul {
      list-style: none;
    }
    .role-card li {
      padding: 0.8rem 0;
      border-bottom: 1px solid #f1f5f9;
      position: relative;
      padding-left: 2rem;
    }
    .role-card li:before {
      content: 'âœ“';
      position: absolute;
      left: 0;
      color: #10b981;
      font-weight: bold;
    }
    .admin-card li:before {
      color: #8b5cf6;
    }
    
    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .main-content {
      margin: 1rem;
      background: linear-gradient(135deg, #faf8ff 0%, #f5f3ff 100%);
      min-height: 100vh;
      padding: 1rem;
      border-radius: 20px;
    }
    
    .compact-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.08);
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
      border: 1px solid rgba(139, 92, 246, 0.1);
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .compact-header h1 {
      font-size: 1.8rem;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
      font-weight: 700;
    }
    
    .compact-header .sub-heading {
      color: #a78bfa;
      margin: 0;
      font-size: 0.85rem;
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      flex-wrap: wrap;
    }
    
    .admin-section {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(139, 92, 246, 0.08);
      margin-bottom: 2rem;
      border-left: 4px solid #a78bfa;
      border: 1px solid rgba(139, 92, 246, 0.1);
    }
    
    .admin-section h2 {
      color: #7c3aed;
      margin-bottom: 1.5rem;
      font-size: 1.3rem;
      font-weight: 600;
    }
    
    .status-available {
      color: #7c3aed;
      font-weight: 600;
      background: rgba(124, 58, 237, 0.1);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
    }
    
    .status-in-use {
      color: #dc2626;
      font-weight: 600;
      background: rgba(220, 38, 38, 0.1);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
    }
    
    button {
      margin: 0.2rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 8px;
      background: linear-gradient(45deg, #a78bfa, #c4b5fd);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      font-size: 0.85rem;
      white-space: nowrap;
    }
    button:hover {
      transform: translateY(-1px);
      background: linear-gradient(45deg, #8b5cf6, #a78bfa);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
    }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®ãƒœã‚¿ãƒ³ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰ã‚‚åŒã˜ã‚¹ã‚¿ã‚¤ãƒ« */
    .header-controls button {
      background: linear-gradient(45deg, #a78bfa, #c4b5fd);
      color: white;
    }
    .header-controls button:hover {
      background: linear-gradient(45deg, #8b5cf6, #a78bfa);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
    }
    
    .delete-button {
      background: linear-gradient(45deg, #f87171, #ef4444) !important;
    }
    .delete-button:hover {
      background: linear-gradient(45deg, #ef4444, #dc2626) !important;
      box-shadow: 0 6px 20px rgba(244, 67, 54, 0.3);
    }
    
    input, select {
      padding: 0.6rem 1rem;
      margin: 0.2rem;
      border-radius: 8px;
      border: 2px solid #e9d5ff;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      background: white;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #a78bfa;
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.1);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      background: white;
      box-shadow: 0 8px 30px rgba(139, 92, 246, 0.08);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(139, 92, 246, 0.1);
    }
    th, td {
      border: 1px solid #f3f0ff;
      padding: 1rem 0.8rem;
      text-align: left;
    }
    th {
  background: linear-gradient(135deg, #a78bfa 0%, #c4b5fd 100%);
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.85rem;
}
th:hover {
  background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
}
    
    tbody tr {
      transition: all 0.3s ease;
    }
    
    tbody tr:hover {
      background: linear-gradient(135deg, #faf8ff 0%, #f3f0ff 100%);
      transform: scale(1.01);
    }
    
    .image-preview {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border: 2px solid #e9d5ff;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .image-preview:hover {
      transform: scale(1.05);
      border-color: #a78bfa;
    }
    
    .image-wrapper {
      position: relative;
      display: inline-block;
      width: 100px;
      height: 100px;
    }
    
    .edit-button {
      position: absolute;
      top: 2px;
      right: 2px;
      background: rgba(139, 92, 246, 0.9);
      color: white;
      border: none;
      padding: 0.3rem 0.5rem;
      font-size: 0.7rem;
      border-radius: 4px;
      display: none;
      cursor: pointer;
      z-index: 2;
      font-weight: 500;
    }
    .edit-button:hover {
      background: rgba(124, 58, 237, 1);
    }
    .image-wrapper:hover .edit-button {
      display: block;
    }
    
    .modal {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .modal-content {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      width: 300px;
    }
    .edit-modal-content {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      width: 400px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
      color: #333;
    }
    .form-group input, .form-group select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .storage-notice {
      background: linear-gradient(45deg, #e3f2fd, #f3e5f5);
      border: 1px solid #2196f3;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1.5rem;
      color: #1976d2;
      font-size: 0.9rem;
      text-align: center;
    }
    .button-group {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    /* ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .error-notice {
      background: linear-gradient(45deg, #fee2e2, #fecaca);
      border: 1px solid #f87171;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
      color: #dc2626;
      text-align: center;
    }
    
    .retry-button {
      background: linear-gradient(45deg, #10b981, #34d399);
      margin-top: 0.5rem;
    }
    .retry-button:hover {
      background: linear-gradient(45deg, #059669, #10b981);
    }
    
    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º */
    .loading {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      padding: 20px 30px;
      border-radius: 12px;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.1);
      color: #7c3aed;
      font-weight: 500;
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 768px) {
      .hero-content {
        grid-template-columns: 1fr;
        gap: 2rem;
        text-align: center;
      }
      .hero-title {
        font-size: 2.5rem;
      }
      .login-card {
        padding: 2rem;
      }
      .roles-grid {
        grid-template-columns: 1fr;
      }
      .container {
        padding: 0 1rem;
      }
      
      .compact-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .header-controls {
        width: 100%;
        justify-content: flex-start;
      }
      
      .compact-header h1 {
        font-size: 1.5rem;
      }
      
      table {
        font-size: 0.85rem;
      }
      
      th, td {
        padding: 0.5rem 0.3rem;
      }
      
      .image-preview {
        width: 60px;
        height: 60px;
      }
      
      .testimonials-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
      }
      
      .testimonial-card {
        padding: 1.5rem;
      }
      
      .testimonials-section .section-title {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <!-- ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ -->
  <div id="loginArea" style="display: block;">
    <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="hero-section">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-title">StockEasy</h1>
          <p class="hero-subtitle">æ–½è¨­å‚™å“ã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã™ã‚‹ã‚¹ãƒãƒ¼ãƒˆãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</p>
          <p class="hero-description">
            å‚™å“ã®è²¸å‡ºãƒ»è¿”å´ã‹ã‚‰åœ¨åº«ç®¡ç†ã¾ã§ã€ã™ã¹ã¦ã‚’ãƒ‡ã‚¸ã‚¿ãƒ«åŒ–ã€‚<br>
            ã‚·ãƒ³ãƒ—ãƒ«ãªæ“ä½œã§ã€æ–½è¨­é‹å–¶ã‚’ã‚‚ã£ã¨ã‚¹ãƒ ãƒ¼ã‚ºã«ã€ã‚‚ã£ã¨æ¥½ã—ãã€‚
          </p>
        </div>
        <div class="login-card">
          <h3>ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³</h3>
          <select id="roleSelect" class="role-select">
            <option value="staff">è·å“¡ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</option>
            <option value="admin">ç®¡ç†è€…ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</option>
          </select>
          <div id="passwordArea" class="password-area">
            <input type="password" id="adminPassword" placeholder="ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
          </div>
          <button id="loginButton" class="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
          <div class="storage-notice">
            <strong>Ver.3.0</strong> - ã‚¯ãƒ©ã‚¦ãƒ‰å¯¾å¿œç‰ˆï¼šãƒ‡ãƒ¼ã‚¿ã¯ã‚µãƒ¼ãƒãƒ¼ã«å®‰å…¨ã«ä¿å­˜ã•ã‚Œã¾ã™
          </div>
        </div>
      </div>
    </section>

    <!-- æ©Ÿèƒ½ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="features-section">
      <div class="container">
        <h2 class="section-title">ä¸»ãªæ©Ÿèƒ½</h2>
        <div class="features-grid">
          <div class="feature-card">
            <div class="feature-icon">ğŸ“‹</div>
            <h3>å‚™å“ç™»éŒ²ãƒ»ç®¡ç†</h3>
            <p>è»Šã„ã™ã€æ­©è¡Œå™¨ã€ã‚¨ã‚¢ãƒãƒƒãƒˆãªã©æ§˜ã€…ãªå‚™å“ã‚’å†™çœŸä»˜ãã§ç™»éŒ²ãƒ»ç®¡ç†ã§ãã¾ã™ã€‚</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ”„</div>
            <h3>è²¸å‡ºãƒ»è¿”å´ç®¡ç†</h3>
            <p>å‚™å“ã®è²¸å‡ºçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡ã€‚æ¨å¥¨è¿”å´å ´æ‰€ã®è¡¨ç¤ºã§åŠ¹ç‡çš„ãªé‹ç”¨ã‚’å®Ÿç¾ã€‚</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ“</div>
            <h3>å ´æ‰€ãƒ»çŠ¶æ…‹è¿½è·¡</h3>
            <p>å„å‚™å“ã®ç¾åœ¨åœ°ã€ä½¿ç”¨çŠ¶æ³ã€å‚™è€ƒæƒ…å ±ã‚’ä¸€ç›®ã§ç¢ºèªã€‚ç´›å¤±é˜²æ­¢ã«ã‚‚åŠ¹æœçš„ã€‚</p>
          </div>
          <div class="feature-card">
            <div class="feature-icon">ğŸ“Š</div>
            <h3>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
            <p>å‚™å“ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã§ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚„ä»–ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã‚‚ç°¡å˜ã€‚</p>
          </div>
        </div>
      </div>
    </section>

    <!-- åˆ©ç”¨è€…ã®å£°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="testimonials-section">
      <div class="container">
        <h2 class="section-title">åˆ©ç”¨è€…ã®å£°</h2>
        <div class="testimonials-grid">
          <div class="testimonial-card">
            <div class="testimonial-content">
              <div class="quote-icon">â­</div>
              <p class="testimonial-text">
                ã€Œä»¥å‰ã¯è»Šã„ã™ãŒã©ã“ã«ã‚ã‚‹ã‹åˆ†ã‹ã‚‰ãšã€åˆ©ç”¨è€…æ§˜ã‚’ãŠå¾…ãŸã›ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚StockEasyã®ãŠã‹ã’ã§ã€ã™ãã«å¿…è¦ãªå‚™å“ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã€
              </p>
            </div>
            <div class="testimonial-author">
              <div class="author-info">
                <h4>å±±ç”° ç”±ç¾å­ æ§˜</h4>
                <span>ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ ã¿ã©ã‚Šã®ä¸˜</span>
                <span class="role">ä»‹è­·ä¸»ä»»</span>
              </div>
            </div>
          </div>
          
          <div class="testimonial-card">
            <div class="testimonial-content">
              <div class="quote-icon">âœ¨</div>
              <p class="testimonial-text">
                ã€ŒStockEasyã‚’å°å…¥ã—ã¦ã‹ã‚‰ã€å¤±ãã—ãŸãƒªãƒ¢ã‚³ãƒ³ã¯è¦‹ã¤ã‹ã‚Šã€é€šå‹¤é›»è»Šã§å¶ç„¶åº§ã‚Œã‚‹æ—¥ãŒç¶šãã€è´”å±“ã®ãƒãƒ¼ãƒ ãŒå„ªå‹ã—ã¦å½¼å¥³ãŒã§ãã¾ã—ãŸã€‚ä¸€ç”Ÿã¤ã„ã¦ã„ãã¾ã™ã€‚ã€
              </p>
            </div>
            <div class="testimonial-author">
              <div class="author-info">
                <h4>ä½è—¤ å¥ä¸€ æ§˜</h4>
                <span>ã‚°ãƒ«ãƒ¼ãƒ—ãƒ›ãƒ¼ãƒ  ã²ã¾ã‚ã‚Šè˜</span>
                <span class="role">æ–½è¨­é•·</span>
              </div>
            </div>
          </div>
          
          <div class="testimonial-card">
            <div class="testimonial-content">
              <div class="quote-icon">ğŸš€</div>
              <p class="testimonial-text">
                ã€Œå†™çœŸä»˜ãã§å‚™å“ã‚’ç™»éŒ²ã§ãã‚‹ã®ã§ã€æ–°äººè·å“¡ã§ã‚‚ã™ãã«å‚™å“ã‚’è­˜åˆ¥ã§ãã¾ã™ã€‚ç ”ä¿®æ™‚é–“ã®çŸ­ç¸®ã«ã‚‚ã¤ãªãŒã£ã¦ã„ã¾ã™ã€‚ã€
              </p>
            </div>
            <div class="testimonial-author">
              <div class="author-info">
                <h4>éˆ´æœ¨ å¤ªéƒ æ§˜</h4>
                <span>ä»‹è­·è€äººä¿å¥æ–½è¨­ å¸Œæœ›ã®é‡Œ</span>
                <span class="role">äº‹å‹™é•·</span>
              </div>
            </div>
          </div>
          
          <div class="testimonial-card">
            <div class="testimonial-content">
              <div class="quote-icon">ğŸ’–</div>
              <p class="testimonial-text">
                ã€Œå‚™å“ã®åœ¨åº«çŠ¶æ³ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡ã§ãã‚‹ãŸã‚ã€è³¼å…¥è¨ˆç”»ã‚‚ç«‹ã¦ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚ç„¡é§„ãªè³¼å…¥ã‚’é˜²ã’ã¦ã€ã‚³ã‚¹ãƒˆå‰Šæ¸›ã«ã‚‚è²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚ã€
              </p>
            </div>
            <div class="testimonial-author">
              <div class="author-info">
                <h4>é«˜æ©‹ æµå­ æ§˜</h4>
                <span>ç‰¹åˆ¥é¤Šè­·è€äººãƒ›ãƒ¼ãƒ  é’ç©ºã®å®¶</span>
                <span class="role">ç·å‹™èª²é•·</span>
              </div>
            </div>
          </div>
          
          <div class="testimonial-card">
            <div class="testimonial-content">
              <div class="quote-icon">ğŸŒŸ</div>
              <p class="testimonial-text">
                ã€Œã‚·ã‚¹ãƒ†ãƒ ãŒç›´æ„Ÿçš„ã§ä½¿ã„ã‚„ã™ãã€ITãŒè‹¦æ‰‹ãªè·å“¡ã§ã‚‚ã™ãã«æ“ä½œã‚’è¦šãˆã‚‰ã‚Œã¾ã—ãŸã€‚å°å…¥ã‹ã‚‰1é€±é–“ã§å…¨å“¡ãŒä½¿ã„ã“ãªã—ã¦ã„ã¾ã™ã€‚ã€
              </p>
            </div>
            <div class="testimonial-author">
              <div class="author-info">
                <h4>ä¼Šè—¤ æ­£å¤« æ§˜</h4>
                <span>æœ‰æ–™è€äººãƒ›ãƒ¼ãƒ  é™½ã ã¾ã‚Šãƒ†ãƒ©ã‚¹</span>
                <span class="role">ã‚±ã‚¢ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- åˆ©ç”¨è€…åˆ¥æ©Ÿèƒ½ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <section class="roles-section">
      <div class="container">
        <h2 class="section-title">åˆ©ç”¨è€…åˆ¥æ©Ÿèƒ½</h2>
        <div class="roles-grid">
          <div class="role-card staff-card">
            <h3>ğŸ‘¥ è·å“¡å‘ã‘æ©Ÿèƒ½</h3>
            <ul>
              <li>å‚™å“ã®è²¸å‡ºãƒ»è¿”å´æ“ä½œ</li>
              <li>å‚™å“çŠ¶æ³ã®ç¢ºèª</li>
              <li>å‚™è€ƒæƒ…å ±ã®è¿½åŠ ãƒ»ç·¨é›†</li>
              <li>ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°</li>
            </ul>
          </div>
          <div class="role-card admin-card">
            <h3>âš™ï¸ ç®¡ç†è€…å‘ã‘æ©Ÿèƒ½</h3>
            <ul>
              <li>æ–°è¦å‚™å“ã®ç™»éŒ²</li>
              <li>å‚™å“æƒ…å ±ã®ç·¨é›†ãƒ»å‰Šé™¤</li>
              <li>å‚™å“ç”»åƒã®ç®¡ç†</li>
              <li>ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
  <div id="loading" class="loading">
    <p>ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ä¸­...</p>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div id="mainContent" class="main-content" style="display: none;">
    <div class="compact-header">
      <div class="logo-section">
        <div>
          <h1>StockEasy</h1>
          <p class="sub-heading">ã‚‰ãã‚‰ãå‚™å“ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>
      </div>
      
      <div class="header-controls">
        <select id="categoryFilter" onchange="filterItems()">
          <option value="">å…¨ã¦è¡¨ç¤º</option>
          <option value="è»Šã„ã™">è»Šã„ã™</option>
          <option value="æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼">æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼</option>
          <option value="å®¶å…·">å®¶å…·</option>
          <option value="ã‚¨ã‚¢ãƒãƒƒãƒˆ">ã‚¨ã‚¢ãƒãƒƒãƒˆ</option>
          <option value="ãã®ä»–">ãã®ä»–</option>
        </select>
        <button onclick="exportData()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData()" />
        <button onclick="document.getElementById('importFile').click()">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <button onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="errorNotice" class="error-notice" style="display: none;">
      <p id="errorMessage">æ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</p>
      <button class="retry-button" onclick="retryConnection()">å†è©¦è¡Œ</button>
    </div>

    <div id="adminArea" class="admin-section" style="display: none">
      <h2>æ–°è¦ç™»éŒ²ï¼ˆç®¡ç†è€…ï¼‰</h2>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
        <input type="text" id="itemName" placeholder="å‚™å“å" />
        <input type="text" id="itemId" placeholder="ID" />
        <select id="itemLocation">
          <option value="äº‹å‹™æ‰€">äº‹å‹™æ‰€</option>
          <option value="1F">1F</option>
          <option value="2F">2F</option>
          <option value="3F">3F</option>
          <option value="4F">4F</option>
          <option value="5F">5F</option>
          <option value="åœ°åŸŸäº¤æµå®¤">åœ°åŸŸäº¤æµå®¤</option>
          <option value="æ©Ÿèƒ½è¨“ç·´å®¤">æ©Ÿèƒ½è¨“ç·´å®¤</option>
        </select>
        <select id="itemCategory">
          <option value="è»Šã„ã™">è»Šã„ã™</option>
          <option value="æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼">æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼</option>
          <option value="å®¶å…·">å®¶å…·</option>
          <option value="ã‚¨ã‚¢ãƒãƒƒãƒˆ">ã‚¨ã‚¢ãƒãƒƒãƒˆ</option>
          <option value="ãã®ä»–">ãã®ä»–</option>
        </select>
        <input type="file" id="itemImage" accept="image/*" />
        <button onclick="registerItem()">ç™»éŒ²</button>
      </div>
    </div>
<div class="tab-navigation">
      <button class="tab-button active" data-category="">å…¨ã¦</button>
      <button class="tab-button" data-category="è»Šã„ã™">è»Šã„ã™</button>
      <button class="tab-button" data-category="æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼">æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼</button>
      <button class="tab-button" data-category="å®¶å…·">å®¶å…·</button>
      <button class="tab-button" data-category="ã‚¨ã‚¢ãƒãƒƒãƒˆ">ã‚¨ã‚¢ãƒãƒƒãƒˆ</button>
      <button class="tab-button" data-category="ãã®ä»–">ãã®ä»–</button>
    </div>
    <table>
  <thead>
    <tr>
      <th>ç”»åƒ</th>
      <th onclick="sortTable('name')" style="cursor: pointer;">å‚™å“å â†•</th>
      <th onclick="sortTable('id')" style="cursor: pointer;">ID â†•</th>
      <th onclick="sortTable('location')" style="cursor: pointer;">ä¿ç®¡å ´æ‰€ â†•</th>
      <th onclick="sortTable('current')" style="cursor: pointer;">ç¾åœ¨åœ° â†•</th>
      <th onclick="sortTable('user')" style="cursor: pointer;">ä½¿ç”¨è€… â†•</th>
      <th onclick="sortTable('status')" style="cursor: pointer;">çŠ¶æ…‹ â†•</th>
      <th>å‚™è€ƒ</th>
      <th onclick="sortTable('category')" style="cursor: pointer;">ç¨®åˆ¥ â†•</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody id="itemTable"></tbody>
</table>

    <div class="modal" id="borrowModal">
      <div class="modal-content">
        <h3>å€Ÿç”¨å…ˆã‚’é¸æŠ</h3>
        <select id="borrowSelect">
          <option>äº‹å‹™æ‰€</option>
          <option>1F</option>
          <option>2F</option>
          <option>3F</option>
          <option>4F</option>
          <option>5F</option>
          <option>åœ°åŸŸäº¤æµå®¤</option>
          <option>æ©Ÿèƒ½è¨“ç·´å®¤</option>
        </select>
        <button onclick="confirmBorrow()">æ±ºå®š</button>
        <button onclick="closeBorrowModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>

    <div class="modal" id="returnModal">
      <div class="modal-content">
        <h3>è¿”å´å ´æ‰€ã‚’é¸æŠ</h3>
        <p id="suggestedReturn"></p>
        <select id="returnSelect">
          <option>äº‹å‹™æ‰€</option>
          <option>1F</option>
          <option>2F</option>
          <option>3F</option>
          <option>4F</option>
          <option>5F</option>
          <option>åœ°åŸŸäº¤æµå®¤</option>
          <option>æ©Ÿèƒ½è¨“ç·´å®¤</option>
        </select>
        <button onclick="confirmReturn()">æ±ºå®š</button>
        <button onclick="closeReturnModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="editModal">
      <div class="edit-modal-content">
        <h3>å‚™å“æƒ…å ±ç·¨é›†</h3>
        <div class="form-group">
          <label for="editItemName">å‚™å“å</label>
          <input type="text" id="editItemName" />
        </div>
        <div class="form-group">
          <label for="editItemId">ID</label>
          <input type="text" id="editItemId" />
        </div>
        <div class="form-group">
          <label for="editItemLocation">ä¿ç®¡å ´æ‰€</label>
          <select id="editItemLocation">
            <option value="äº‹å‹™æ‰€">äº‹å‹™æ‰€</option>
            <option value="1F">1F</option>
            <option value="2F">2F</option>
            <option value="3F">3F</option>
            <option value="4F">4F</option>
            <option value="5F">5F</option>
            <option value="åœ°åŸŸäº¤æµå®¤">åœ°åŸŸäº¤æµå®¤</option>
            <option value="æ©Ÿèƒ½è¨“ç·´å®¤">æ©Ÿèƒ½è¨“ç·´å®¤</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editItemCategory">ç¨®åˆ¥</label>
          <select id="editItemCategory">
            <option value="è»Šã„ã™">è»Šã„ã™</option>
            <option value="æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼">æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼</option>
            <option value="å®¶å…·">å®¶å…·</option>
            <option value="ã‚¨ã‚¢ãƒãƒƒãƒˆ">ã‚¨ã‚¢ãƒãƒƒãƒˆ</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
        </div>
        <div class="button-group">
          <button onclick="confirmEdit()">ä¿å­˜</button>
          <button onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          <button class="delete-button" onclick="confirmDelete()">å‰Šé™¤</button>
        </div>
      </div>
    </div>

    <input type="file" id="editImageInput" accept="image/*" style="display:none" />
  </div>

  <script>
   let items = [];
let currentIndex = null;
let isAdmin = false;
let editingIndex = null;
let connectionRetries = 0;
const maxRetries = 3;
let sortColumn = '';
let sortDirection = 'asc';
    
    <!-- ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ -->
    // API URLã‚’å‹•çš„ã«è¨­å®š
    const USE_LOCAL_STORAGE = false; // æœ¬ç•ªç”¨ï¼ˆã‚µãƒ¼ãƒãƒ¼ä¿å­˜ï¼‰
    const API_BASE = window.location.origin + '/api';
    
    // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
    const DEBUG = true;
    function debugLog(...args) {
      if (DEBUG) console.log('[StockEasy]', ...args);
    }
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    function showLoading() {
      document.getElementById('loading').style.display = 'block';
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function showError(message) {
      const errorNotice = document.getElementById('errorNotice');
      const errorMessage = document.getElementById('errorMessage');
      errorMessage.textContent = message;
      errorNotice.style.display = 'block';
    }

    function hideError() {
      document.getElementById('errorNotice').style.display = 'none';
    }

    // æ¥ç¶šå†è©¦è¡Œ
    async function retryConnection() {
      hideError();
      if (connectionRetries < maxRetries) {
        connectionRetries++;
        console.log(`æ¥ç¶šå†è©¦è¡Œ ${connectionRetries}/${maxRetries}`);
        await loadItems();
        renderItems();
      } else {
        showError('æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
    function getLocalData() {
      const data = localStorage.getItem('stockeasy_items');
      return data ? JSON.parse(data) : [];
    }

    function saveLocalData(data) {
      localStorage.setItem('stockeasy_items', JSON.stringify(data));
    }

    // APIå‘¼ã³å‡ºã—ç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆæ”¹å–„ç‰ˆï¼‰
    async function apiCall(url, options = {}) {
      showLoading();
      try {
        if (USE_LOCAL_STORAGE) {
          // ãƒ‡ãƒ¢ç”¨ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨
          await new Promise(resolve => setTimeout(resolve, 500)); // ç–‘ä¼¼çš„ãªé…å»¶
          
          if (url.includes('/equipment') && !options.method) {
            // GET /equipment
            const data = getLocalData();
            hideError();
            connectionRetries = 0;
            return data;
          } else if (url.includes('/equipment') && options.method === 'POST') {
            // POST /equipment
            const newItem = JSON.parse(options.body);
            const existingData = getLocalData();
            
            // IDã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
            if (existingData.some(item => item.id === newItem.id)) {
              throw new Error('ã“ã®IDã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™');
            }
            
            existingData.push({
              ...newItem,
              status: 'å¾…æ©Ÿ',
              current: '',
              user: '',
              note: '',
              createdAt: new Date().toISOString(),
              history: newItem.history || []
            });
            saveLocalData(existingData);
            hideError();
            connectionRetries = 0;
            return { success: true, message: 'å‚™å“ãŒç™»éŒ²ã•ã‚Œã¾ã—ãŸ' };
          } else if (url.includes('/equipment/') && options.method === 'PUT') {
            // PUT /equipment/:id
            const itemId = url.split('/').pop();
            const updateData = JSON.parse(options.body);
            const existingData = getLocalData();
            const itemIndex = existingData.findIndex(item => item.id === itemId);
            
            if (itemIndex === -1) {
              throw new Error('å‚™å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            existingData[itemIndex] = { ...existingData[itemIndex], ...updateData };
            saveLocalData(existingData);
            hideError();
            connectionRetries = 0;
            return { success: true, message: 'å‚™å“æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ' };
          } else if (url.includes('/equipment/') && options.method === 'DELETE') {
            // DELETE /equipment/:id
            const itemId = url.split('/').pop();
            const existingData = getLocalData();
            const newData = existingData.filter(item => item.id !== itemId);
            
            if (newData.length === existingData.length) {
              throw new Error('å‚™å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            saveLocalData(newData);
            hideError();
            connectionRetries = 0;
            return { success: true, message: 'å‚™å“ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ' };
          } else if (url.includes('/export')) {
            // GET /export
            const data = getLocalData();
            hideError();
            connectionRetries = 0;
            return data;
          } else if (url.includes('/import')) {
            // POST /import
            const importData = JSON.parse(options.body);
            saveLocalData(importData);
            hideError();
            connectionRetries = 0;
            return { success: true, message: 'ãƒ‡ãƒ¼ã‚¿ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸ' };
          }
          
          throw new Error('ä¸æ˜ãªAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ');
        }
        
        // æœ¬æ¥ã®APIå‘¼ã³å‡ºã—å‡¦ç†
        console.log('APIå‘¼ã³å‡ºã—:', url);
        
        const response = await fetch(url, {
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          timeout: 10000, // 10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
          ...options
        });
        
        console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹çŠ¶æ…‹:', response.status);
        
        if (!response.ok) {
          const errorText = await response.text();
          console.error('APIã‚¨ãƒ©ãƒ¼è©³ç´°:', errorText);
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        const data = await response.json();
        console.log('å–å¾—ãƒ‡ãƒ¼ã‚¿:', data);
        hideError();
        connectionRetries = 0;
        return data;
      } catch (error) {
        console.error('API Error:', error);
        
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          showError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“');
        } else {
          showError(`ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }
        throw error;
      } finally {
        hideLoading();
      }
    }

    // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆæ”¹å–„ç‰ˆï¼‰
    async function loadItems() {
      try {
        if (!isLoggedIn()) {
          console.log('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ãŸã‚ã€ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—');
          return;
        }
        
        console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
        items = await apiCall(`${API_BASE}/equipment`);
        console.log(`${items.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
        hideError();
      } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        items = [];
        if (connectionRetries < maxRetries) {
          showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
        }
      }
    }
    
    // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç¢ºèª
    function isLoggedIn() {
      return document.getElementById('mainContent').style.display === 'block';
    }

    // ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
    async function exportData() {
      try {
        const data = await apiCall(`${API_BASE}/export`);
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'equipment_data.json';
        link.click();
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    async function importData() {
      const file = document.getElementById('importFile').files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async function(e) {
        try {
          const importedData = JSON.parse(e.target.result);
          if (confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ãæ›ãˆã¾ã™ã‹ï¼Ÿ')) {
            await apiCall(`${API_BASE}/import`, {
              method: 'POST',
              body: JSON.stringify(importedData)
            });
            await loadItems();
            renderItems();
            alert('ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
          }
        } catch (error) {
          alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };
      reader.readAsText(file);
    }
// ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
function sortTable(column) {
  // åŒã˜åˆ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ã€ã‚½ãƒ¼ãƒˆæ–¹å‘ã‚’åè»¢
  if (sortColumn === column) {
    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
  } else {
    sortColumn = column;
    sortDirection = 'asc';
  }
  
  // ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚½ãƒ¼ãƒˆ
  items.sort((a, b) => {
    let aValue = a[column] || '';
    let bValue = b[column] || '';
    
    
    // æ•°å€¤ã¨ã—ã¦æ¯”è¼ƒã§ãã‚‹å ´åˆã¯æ•°å€¤æ¯”è¼ƒ
    if (!isNaN(aValue) && !isNaN(bValue) && aValue !== '' && bValue !== '') {
      aValue = parseFloat(aValue);
      bValue = parseFloat(bValue);
    } else {
      // æ–‡å­—åˆ—ã¨ã—ã¦æ¯”è¼ƒï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ï¼‰
      aValue = aValue.toString().toLowerCase();
      bValue = bValue.toString().toLowerCase();
    }
    
    if (sortDirection === 'asc') {
      return aValue > bValue ? 1 : aValue < bValue ? -1 : 0;
    } else {
      return aValue < bValue ? 1 : aValue > bValue ? -1 : 0;
    }
  });
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ç¶­æŒã—ã¦å†æç”»
  const currentFilter = document.getElementById('categoryFilter').value;
  renderItems(currentFilter);
}
    // ãƒ•ã‚£ãƒ«ã‚¿æ©Ÿèƒ½
    function filterItems() {
      const category = document.getElementById('categoryFilter').value;
      renderItems(category);
    }

    function renderItems(filterCategory = '') {
      const tbody = document.getElementById('itemTable');
      tbody.innerHTML = '';
      
      // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
      const filteredItems = filterCategory 
        ? items.filter(item => item.category === filterCategory)
        : items;
      
      if (filteredItems.length === 0) {
        const tr = document.createElement('tr');
        tr.innerHTML = '<td colspan="10" style="text-align: center; padding: 2rem;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td>';
        tbody.appendChild(tr);
        return;
      }
      
      filteredItems.forEach((item, originalIndex) => {
        // å…ƒã®é…åˆ—ã§ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
        const actualIndex = items.findIndex(i => i.id === item.id);
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <div class="image-wrapper">
              <img src="${item.image || ''}" class="image-preview" onerror="this.style.display='none'" />
              ${isAdmin ? `<button class="edit-button" onclick="editImage(${actualIndex})">ç”»åƒ</button>` : ''}
            </div>
          </td>
          <td>${item.name || ''}</td>
          <td>${item.id || ''}</td>
          <td>${item.location || ''}</td>
          <td>${item.current || ''}</td>
          <td>${item.user || ''}</td>
          <td>
            <span class="${item.status === 'å¾…æ©Ÿ' ? 'status-available' : 'status-in-use'}">
              ${item.status || 'å¾…æ©Ÿ'}
            </span>
          </td>
          <td><input type="text" value="${item.note || ''}" onchange="updateNote(${actualIndex}, this.value)" /></td>
          <td>${item.category || ''}</td>
          <td>
            <button onclick="openBorrow(${actualIndex})">å€Ÿç”¨</button>
            <button onclick="openReturn(${actualIndex})">è¿”å´</button>
            ${isAdmin ? `<button onclick="openEdit(${actualIndex})">ç·¨é›†</button>` : ''}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // å‚™è€ƒæ›´æ–°
    async function updateNote(index, note) {
      try {
        const item = items[index];
        await apiCall(`${API_BASE}/equipment/${item.id}`, {
          method: 'PUT',
          body: JSON.stringify({ note })
        });
        items[index].note = note;
      } catch (error) {
        console.error('å‚™è€ƒã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('å‚™è€ƒã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ç”»åƒã‚’åœ§ç¸®ã™ã‚‹é–¢æ•°
    function compressImage(file, maxWidth = 300, quality = 0.7) {
      return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = () => {
          const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
          canvas.width = img.width * ratio;
          canvas.height = img.height * ratio;
          
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          
          const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
          resolve(compressedDataUrl);
        };
        
        img.src = URL.createObjectURL(file);
      });
    }

    async function registerItem() {
      const name = document.getElementById('itemName').value;
      const id = document.getElementById('itemId').value;
      const location = document.getElementById('itemLocation').value;
      const category = document.getElementById('itemCategory').value;
      const imageFile = document.getElementById('itemImage').files[0];

      if (!name || !id || !location) {
        alert('å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      const item = {
        name: name,
        id: id,
        location: location,
        category: category,
        history: []
      };

      if (imageFile) {
        try {
          console.log('ç”»åƒã‚’åœ§ç¸®ä¸­...');
          const compressedImage = await compressImage(imageFile, 300, 0.6);
          console.log(`åœ§ç¸®å®Œäº†: ${compressedImage.length} æ–‡å­—`);
          
          item.image = compressedImage;
          
          await apiCall(`${API_BASE}/equipment`, {
            method: 'POST',
            body: JSON.stringify(item)
          });
          await loadItems();
          renderItems();
          clearForm();
          alert('å‚™å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼ˆç”»åƒåœ§ç¸®æ¸ˆã¿ï¼‰');
        } catch (error) {
          console.error('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          alert(`ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
      } else {
        try {
          await apiCall(`${API_BASE}/equipment`, {
            method: 'POST',
            body: JSON.stringify(item)
          });
          await loadItems();
          renderItems();
          clearForm();
          alert('å‚™å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        } catch (error) {
          console.error('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          alert(`ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
        }
      }
    }

    function clearForm() {
      document.getElementById('itemName').value = '';
      document.getElementById('itemId').value = '';
      document.getElementById('itemLocation').value = 'äº‹å‹™æ‰€';
      document.getElementById('itemCategory').value = 'è»Šã„ã™';
      document.getElementById('itemImage').value = '';
    }

    async function editImage(index) {
      const input = document.getElementById('editImageInput');
      input.onchange = async () => {
        const file = input.files[0];
        if (file) {
          try {
            console.log('ç”»åƒã‚’åœ§ç¸®ä¸­...');
            const compressedImage = await compressImage(file, 300, 0.6);
            console.log(`åœ§ç¸®å®Œäº†: ${compressedImage.length} æ–‡å­—`);
            
            const item = items[index];
            await apiCall(`${API_BASE}/equipment/${item.id}`, {
              method: 'PUT',
              body: JSON.stringify({ image: compressedImage })
            });
            items[index].image = compressedImage;
            renderItems();
            alert('ç”»åƒã‚’æ›´æ–°ã—ã¾ã—ãŸï¼ˆåœ§ç¸®æ¸ˆã¿ï¼‰');
          } catch (error) {
            console.error('ç”»åƒã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            alert('ç”»åƒã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
        } else {
          try {
            const item = items[index];
            await apiCall(`${API_BASE}/equipment/${item.id}`, {
              method: 'PUT',
              body: JSON.stringify({ image: '' })
            });
            delete items[index].image;
            renderItems();
            alert('ç”»åƒã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
          } catch (error) {
            console.error('ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
            alert('ç”»åƒã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
        }
      };
      input.click();
    }

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®é–¢æ•°
    function openEdit(index) {
      editingIndex = index;
      const item = items[index];
      
      document.getElementById('editItemName').value = item.name || '';
      document.getElementById('editItemId').value = item.id || '';
      document.getElementById('editItemLocation').value = item.location || '';
      document.getElementById('editItemCategory').value = item.category || '';
      
      document.getElementById('editModal').style.display = 'flex';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      editingIndex = null;
    }

async function confirmEdit() {
  if (editingIndex === null) return;
  
  const name = document.getElementById('editItemName').value;
  const newId = document.getElementById('editItemId').value;
  const location = document.getElementById('editItemLocation').value;
  const category = document.getElementById('editItemCategory').value;

  if (!name || !newId || !location) {
    alert('å¿…è¦ãªæƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  try {
    const oldItem = items[editingIndex];
    const response = await fetch(`${API_BASE}/equipment/${oldItem.id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name,
        location,
        category
      })
    });
    
    const result = await response.json();
    
    if (!result.success) {
      alert(result.message);  // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      return;
    }
    
    if (oldItem.id !== newId) {
      alert('IDã®å¤‰æ›´ã¯ç¾åœ¨ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
      closeEditModal();
      return;
    }

    await loadItems();
    renderItems();
    closeEditModal();
    alert('å‚™å“æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
  } catch (error) {
    console.error('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
    alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  }
}

    async function confirmDelete() {
      if (editingIndex === null) return;
      
      if (confirm(`å‚™å“ã€Œ${items[editingIndex].name}ã€ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
        try {
          const item = items[editingIndex];
          await apiCall(`${API_BASE}/equipment/${item.id}`, {
            method: 'DELETE'
          });
          await loadItems();
          renderItems();
          closeEditModal();
          alert('å‚™å“ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        } catch (error) {
          console.error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      }
    }

    function openBorrow(index) {
      currentIndex = index;
      document.getElementById('borrowModal').style.display = 'flex';
    }

    function closeBorrowModal() {
      document.getElementById('borrowModal').style.display = 'none';
    }

    async function confirmBorrow() {
      const place = document.getElementById('borrowSelect').value;
      const timestamp = new Date().toLocaleString('ja-JP');
      
      try {
        const item = items[currentIndex];
        const newHistory = [...(item.history || []), { 
          action: 'å€Ÿç”¨', 
          place: place, 
          timestamp: timestamp 
        }];

        await apiCall(`${API_BASE}/equipment/${item.id}`, {
          method: 'PUT',
          body: JSON.stringify({
            user: place,
            current: place,
            status: 'ä½¿ç”¨ä¸­',
            history: newHistory
          })
        });

        items[currentIndex].user = place;
        items[currentIndex].current = place;
        items[currentIndex].status = 'ä½¿ç”¨ä¸­';
        items[currentIndex].history = newHistory;
        
        renderItems();
        closeBorrowModal();
        alert('å€Ÿç”¨å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ');
      } catch (error) {
        console.error('å€Ÿç”¨å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('å€Ÿç”¨å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    function openReturn(index) {
  // çŠ¶æ…‹ãŒã€Œå¾…æ©Ÿã€ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
  if (items[index].status === 'å¾…æ©Ÿ') {
    alert('ã“ã®å‚™å“ã¯ç¾åœ¨è²¸ã—å‡ºã—ã¦ã„ã¾ã›ã‚“');
    return;
  }
  
  currentIndex = index;
  const location = items[index].location;
  document.getElementById('suggestedReturn').textContent = `æ¨å¥¨è¿”å´å ´æ‰€ï¼š${location}`;
  document.getElementById('returnModal').style.display = 'flex';
}

    function closeReturnModal() {
      document.getElementById('returnModal').style.display = 'none';
    }

    async function confirmReturn() {
      const place = document.getElementById('returnSelect').value;
      const timestamp = new Date().toLocaleString('ja-JP');
      
      try {
        const item = items[currentIndex];
        const newHistory = [...(item.history || []), { 
          action: 'è¿”å´', 
          place: place, 
          timestamp: timestamp 
        }];

        await apiCall(`${API_BASE}/equipment/${item.id}`, {
          method: 'PUT',
          body: JSON.stringify({
            user: '',
            current: place,
            status: 'å¾…æ©Ÿ',
            history: newHistory
          })
        });

        items[currentIndex].user = '';
        items[currentIndex].current = place;
        items[currentIndex].status = 'å¾…æ©Ÿ';
        items[currentIndex].history = newHistory;
        
        renderItems();
        closeReturnModal();
        alert('è¿”å´å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ');
      } catch (error) {
        console.error('è¿”å´å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('è¿”å´å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function login() {
      try {
        debugLog('ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†é–‹å§‹');
        
        const role = document.getElementById('roleSelect').value;
        const password = document.getElementById('adminPassword').value;
        
        debugLog('é¸æŠã•ã‚ŒãŸå½¹å‰²:', role);
        
        if (role === 'admin') {
  const response = await fetch('/api/admin/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username: 'admin',
      password: password
    })
  });
  
  const result = await response.json();
  
  if (!result.success) {
    alert(result.message);
    return;
  }
}
        
        debugLog('èªè¨¼æˆåŠŸã€ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–‹å§‹');
        
        // ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆ
        document.getElementById('loginArea').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        isAdmin = role === 'admin';
        document.getElementById('adminArea').style.display = isAdmin ? 'block' : 'none';
        
        debugLog('ç”»é¢åˆ‡ã‚Šæ›¿ãˆå®Œäº†ã€ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹');
        
        // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        try {
          await loadItems();
          renderItems();
          debugLog('ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†');
        } catch (error) {
          console.error('ãƒ­ã‚°ã‚¤ãƒ³å¾Œã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
          // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¦ã‚‚ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¯ç¶­æŒ
          renderItems(); // ç©ºã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¡¨ç¤º
          showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
        }
      } catch (error) {
        console.error('ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼:', error);
        alert('ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
      }
    }

    function logout() {
      document.getElementById('loginArea').style.display = 'block';
      document.getElementById('mainContent').style.display = 'none';
      hideError();
      items = [];
      isAdmin = false;
      connectionRetries = 0;
    }

    // å½¹å‰²é¸æŠã®å¤‰æ›´ã«å¿œã˜ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º/éè¡¨ç¤º
    function handleRoleChange() {
      const role = document.getElementById('roleSelect').value;
      const passwordArea = document.getElementById('passwordArea');
      
      if (role === 'admin') {
        passwordArea.style.display = 'block';
      } else {
        passwordArea.style.display = 'none';
        document.getElementById('adminPassword').value = '';
      }
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹å‡¦ç†ï¼ˆèƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ï¼‰
    function setupModalEvents() {
      // å„ãƒ¢ãƒ¼ãƒ€ãƒ«ã®èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
      document.getElementById('borrowModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeBorrowModal();
        }
      });

      document.getElementById('returnModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeReturnModal();
        }
      });

      document.getElementById('editModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeEditModal();
        }
      });
    }

    // åˆæœŸåŒ–å‡¦ç†
function initializeApp() {
  debugLog('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–é–‹å§‹');
  
  try {
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
    const loginButton = document.getElementById('loginButton');
    const roleSelect = document.getElementById('roleSelect');
    
    if (!loginButton) {
      throw new Error('ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
    
    if (!roleSelect) {
      throw new Error('å½¹å‰²é¸æŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
    
    // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã¨ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œ
    loginButton.addEventListener('click', function(e) {
      e.preventDefault();
      login();
    });
    
    // ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
    loginButton.addEventListener('touchstart', function(e) {
      e.preventDefault();
      login();
    });
    
    debugLog('ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š');
    
    roleSelect.addEventListener('change', handleRoleChange);
    debugLog('å½¹å‰²é¸æŠã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š');

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
    setupModalEvents();
    
    // ã‚¿ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®šã‚’è¿½åŠ 
    setupTabEvents();
    
    // Enterã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
    const adminPassword = document.getElementById('adminPassword');
    if (adminPassword) {
      adminPassword.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          login();
        }
      });
    }
    
    debugLog('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–å®Œäº†');

// ã“ã®ä¸‹ã«æ–°ã—ã„é–¢æ•°ã‚’2ã¤è¿½åŠ 
function setupTabEvents() {
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
      const category = button.dataset.category;
      filterByTab(category);
    });
  });
}

function filterByTab(category) {
  // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
  document.querySelectorAll('.tab-button').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.category === category) {
      btn.classList.add('active');
    }
  });
  
  // çµã‚Šè¾¼ã¿è¡¨ç¤º
  renderItems(category);
}
        
        // ãƒ‡ãƒ¢ç”¨ï¼šåˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®š
        if (USE_LOCAL_STORAGE && getLocalData().length === 0) {
          const demoData = [
            {
              id: 'WC001',
              name: 'è»Šã„ã™ï¼ˆè‡ªèµ°å¼ï¼‰',
              location: 'äº‹å‹™æ‰€',
              category: 'è»Šã„ã™',
              current: '',
              user: '',
              status: 'å¾…æ©Ÿ',
              note: '',
              image: '',
              history: [],
              createdAt: new Date().toISOString()
            },
            {
              id: 'WK001',
              name: 'æ­©è¡Œå™¨ï¼ˆ4è¼ªï¼‰',
              location: '1F',
              category: 'æ­©è¡Œå™¨ãƒ»ã‚·ãƒ«ãƒãƒ¼ã‚«ãƒ¼',
              current: '2F',
              user: '2F',
              status: 'ä½¿ç”¨ä¸­',
              note: 'å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ¸ˆã¿',
              image: '',
              history: [
                { action: 'å€Ÿç”¨', place: '2F', timestamp: '2025/6/11 10:30:00' }
              ],
              createdAt: new Date().toISOString()
            },
            {
              id: 'AM001',
              name: 'ã‚¨ã‚¢ãƒãƒƒãƒˆï¼ˆè¤¥ç˜¡äºˆé˜²ï¼‰',
              location: 'æ©Ÿèƒ½è¨“ç·´å®¤',
              category: 'ã‚¨ã‚¢ãƒãƒƒãƒˆ',
              current: '',
              user: '',
              status: 'å¾…æ©Ÿ',
              note: 'æ¸…æ‹­æ¸ˆã¿',
              image: '',
              history: [],
              createdAt: new Date().toISOString()
            }
          ];
          saveLocalData(demoData);
          debugLog('ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
      }
    }

    // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«åˆæœŸåŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>
